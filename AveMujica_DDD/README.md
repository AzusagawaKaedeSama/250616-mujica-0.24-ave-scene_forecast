# 多源数据负荷预测系统 - DDD架构版本

## 项目概述

这是一个基于DDD（领域驱动设计）架构的多源数据电力负荷预测系统，支持日前预测、日内滚动预测和不确定性刻画。系统整合了天气数据、历史负荷数据，并使用深度学习模型进行预测。

## 架构设计

### 四层架构

```
┌─────────────────────────────────────────────────────────────┐
│                     用户接口层 (Interface)                    │
│  Web前端、RESTful API、CLI工具                               │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                     应用层 (Application)                     │
│  ForecastService、ScenarioAnalysisService、TrainingService  │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                      领域层 (Domain)                        │
│  WeatherScenario、PredictionModel、Forecast                │
│  UncertaintyCalculationService、ForecastFusionService       │
└─────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────┐
│                    基础设施层 (Infrastructure)                │
│  数据库、ML框架、外部数据源、文件系统                          │
└─────────────────────────────────────────────────────────────┘
```

### 核心聚合根

1. **WeatherScenario** - 天气场景聚合
   - 17种天气场景类型（极端高温、暴雨、正常等）
   - 每种场景都有对应的不确定性倍数

2. **PredictionModel** - 预测模型聚合
   - 模型元数据和自我描述
   - 支持LOAD、PV、WIND三种预测类型
   - 包含目标列和特征列信息

3. **Forecast** - 预测结果聚合
   - 包含时间序列预测数据点
   - 每个数据点都有预测值、上下界
   - 关联使用的模型和天气场景

## 核心功能

### 1. 日前负荷预测
- 基于历史数据和天气预报进行24小时负荷预测
- 支持不确定性量化和置信区间计算
- 天气场景感知的动态不确定性调整

### 2. 天气场景识别
- 17种预定义天气场景
- 基于温度、湿度、风速等气象要素自动识别
- 每种场景对应不同的预测不确定性倍数

### 3. 多源数据融合
- 支持CSV文件、数据库等多种数据源
- 统一的数据访问接口
- 自动特征工程和数据预处理

## 技术栈

- **机器学习框架**: PyTorch
- **数据处理**: Pandas, NumPy
- **数据库**: SQLite
- **特征工程**: scikit-learn
- **架构模式**: DDD (Domain-Driven Design)

## 快速开始

### 环境要求
- Python 3.10+
- PyTorch
- Pandas
- scikit-learn

### 运行示例
```bash
# 运行完整的预测流程
python main.py
```

### 输出示例
```
--- 预测成功！ ---
预测ID: ce7dc8c2-2bd9-4a84-8788-cd2173ac9ccb
省份: 上海
使用模型: default_load_model
天气场景: 温和正常
预测值: 26484.398 MW
```

## 项目结构

```
AveMujica_DDD/
├── application/           # 应用层
│   ├── dtos/             # 数据传输对象
│   ├── ports/            # 外部接口定义
│   └── services/         # 应用服务
├── domain/               # 领域层
│   ├── aggregates/       # 聚合根
│   ├── repositories/     # 仓储接口
│   └── services/         # 领域服务
└── infrastructure/       # 基础设施层
    ├── adapters/         # 外部系统适配器
    ├── data_providers/   # 数据提供者
    ├── feature_engineering/ # 特征工程
    ├── repositories/     # 仓储实现
    └── scalers/          # 数据标准化
```

## 设计原则

### 1. 依赖倒置
- 高层模块不依赖低层模块
- 都依赖于抽象接口
- 抽象不依赖于具体实现

### 2. 单一职责
- 每个类只有一个变化的理由
- 清晰的层次边界和职责分离

### 3. 开闭原则
- 对扩展开放，对修改关闭
- 通过接口和依赖注入支持新功能

### 4. 领域驱动
- 业务逻辑集中在领域层
- 使用统一语言描述业务概念
- 复杂性通过聚合和值对象管理

## 扩展指南

### 添加新的预测类型
1. 在`ForecastType`枚举中添加新类型
2. 创建相应的模型和特征工程逻辑
3. 在应用服务中添加新的用例方法

### 添加新的天气场景
1. 在`ScenarioType`枚举中定义新场景
2. 在天气场景仓储中添加场景实例
3. 更新场景识别逻辑

### 集成新的数据源
1. 实现相应的数据提供者接口
2. 在组装根中注入新的实现
3. 无需修改现有业务逻辑

## 测试

项目包含完整的单元测试，展示了DDD架构的可测试性：

```bash
# 运行测试
python -m pytest AveMujica_DDD/tests/
```

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。请确保：
1. 遵循DDD架构原则
2. 保持清晰的层次边界
3. 添加适当的测试覆盖

## 许可证

MIT License